<!DOCTYPE html>

<html>

<head>

	<title> LB Snake </title>

	<style>

		#body {
			background-color: black;
		}

	</style>

</head>


<body id="body">

		<table>
			
			<tr>
				<th>
					
					<h1 id="h1"> Laabe-Buslaev BreakOut 2.2 Classic </h1>

				</th>

			</tr>

			<tr>
				<th>

					<canvas id="canvas" width="1000" height="1000" style="border:1px solid #FFFFFF"> </canvas>
					
				</th>

			</tr>
		</table>

	<script>

		const canvas = document.getElementById("canvas");
		const ctx = canvas.getContext("2d");

		const grid = 20;

		class Snake() {
			constructor(){
				this.direction = "UP"
				this.body = [Body(10,10)]
				this.newbody = false
			}
			draw() {
				for (i = 0; i < this.body.length; i++) {
					self.body[i].draw();
					}
				}
			move() {
				x = this.body[0].x
				y = this.body[0].y

				if (this.direction == "UP") {
					this.body[0].y -= 1
				} else if (this.direction == "DOWN") {
					this.body[0].y += 1
				} else if (this.direction == "LEFT") {
					this.body[0].x -= 1
				} else if (this.direction == "RIGHT") {
					this.body[0].x += 1
				}	

			for (i = 1; i < this.body.length; i++) {
				let a;
				a = x;
				x = this.body[i].x;
				this.body[i].x = a;

				a = y;
				y = this.body[i].y;
				this.body[i].y = a;
			}

			if ((this.body[0].x < 0) || (this.body[0].x > 49) || (this.body[0].y < 0) || (this.body[0].y > 49)){
            	this.isDying = true
        	}
	        for (i = 1; i< this.body.length-1; i++){
	            if (this.body[i].x == this.body[0].x) and (this.body[i].y == this.body[0].y):
	                this.isDying = true
	        }
	        if (this.newbody){
	            this.body.append(Body(x,y))
	            this.newbody = false
	        }

		}
	}

		class Apple() {
			constructor() {
				this.x = 0;
				this.y = 0;
			}
			teleport(a) {
				while (true){
					this.x = Math.floor(Math.random() * 50);
					this.y = Math.floor(Math.random() * 50);
					for (i = 0; i < a.length; i++) {
						if (this.x == a[i].x) {
							continue;
						}
						if (this.y == a[i].y) {
							continue;
						}
					}
					break;
				}
			}
			draw() {
				ctx.fillStyle = "#FF0000";
				ctx.fillRect(this.x, this.y, grid, grid);	
			}
			collide(a) {
				return (a[0].x == this.x) && (a[0].y == this.y)

			}

		}

		class Body() {
			constructor(x,y) {
				this.x = x;
				this.y = y;
			}
			draw() {

				ctx.fillStyle = "00FF00";
				ctx.fillRect(this.x, this.y, grid, grid);				
			}
		}
		function Die() {
			a = Snake();
			b = Apple();

		}
		function beepboop(a = ""){
				alert("beepboop"+ a);
			}

		Die();

		function loop() {
			requestAnimationFrame(loop);
			beepboop();

			ctx.clearRect(0,0,canvas.width,canvas.height);

			a.draw();
			
			b.draw();

			if (a.isDying) {
				Die();
			}

			a.move()

			if (b.collide(a.body)) {
				a.newbody = true;
				b.teleport(a.body);
			}

			ctx.font = "35px Arial";
			ctx.fillStyle = "white";
			ctx.fillText("Очки: " + a.body.length, 10, 35);

			
		}

		document.addEventListener('keydown', buttonpress);
				function buttonpress(e) {
					if (e.which === 38) {
						a.direction = "UP";
					} else if (e.which === 40) {
						a.direction = "DOWN";
					} else if (e.which === 37) {
						a.direction = "LEFT";
					} else if (e.which === 39) {
						a.direction = "RIGHT";
					}
				}


	</script>


</body>

</html>