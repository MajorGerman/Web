<!DOCTYPE html>

<html>
	
	<head>

		<title> Game </title>
                
                <style>

			html, body {

				height: 100%;
				margin: 0;
			}

			body {

				background: black;
				display: flex;
				align-items: center;
				justify-content: center;

			}

		</style>

	</head>

	<body>

		<audio id="deadsound"> 
			<source src="MamkaSgorela.wav">
		</audio>

		<canvas id="canvas" width="1920" height="1080"> </canvas>

		<script type="text/javascript">
			
			const canvas = document.getElementById("canvas");
			const ctx = canvas.getContext("2d");

			const grid = 15;
			const paddleWidth = grid * 10;

			const paddleHeight = grid * 13;

			var paddleSpeed = 13;
			var ballSpeed = 9;
			var tped = 0;
			var cellsAmount = 13;

			const maxdownx = canvas.width - grid - paddleHeight;
/*
			class up_factory(){
				fabricate(){
					this.x = 0;
					this.ups = [];
					for(let i = 0; i < 4; i++) {
						for (let j = 0; j < 10; j++){
							ups.push(new up(j*110,i*25));
							x++;
						}
						
					}

				}
				collideses(obj){
					for(i = 0 ; i < x; i++){
						if (collides(obj, this.ups[i])){
							return this.ups[i];
							this.x-=1;
						}
					}
				}
			}
*/
			class up {
				constructor(x,y) {

					this.x = x;
					this.y = y;
					this.width = 100;
					this.height = 20;

				}
				draw(){
					ctx.fillRect(this.x, this.y,this.width,this.height);
				} 

			}

			class cell {
				constructor(x,y,dx,dy) {

					this.dx = dx;
					this.dy = dy;
					this.speed = 0;
					this.x = x;
					this.y = y;
					this.width = 15;
					this.height =  15;

				}
				draw(){
					ctx.fillRect(this.x, this.y,this.width,this.height);
				}
			}


			const ball = {

				x: canvas.width / 2,
				y: canvas.height / 2,

				width: grid,
				height: grid,

				resetting: false,

				dx: ballSpeed,
				dy: -ballSpeed

			};

			function collides(obj1, obj2) {

				return obj1.x < obj2.x + obj2.width &&
					obj1.x + obj1.width > obj2.x &&
					obj1.y < obj2.y + obj2.height &&
					obj1.y + obj1.height > obj2.y;

			}
			var ups = [];
			var paddle = [];
			var dead = document.getElementById("deadsound");

			

			function start(){
				ups = [];
				paddle = [];

				ball.x = canvas.width / 2;
				ball.y = canvas.height / 2;
				ball.dy = -ballSpeed;

				//down.x = canvas.width / 2 - paddleWidth / 2;

				seconds = -1;

				for (i = 0; i < 10; i++){
					for (j = 0; j < 14; j++){
						ups.push(new up(j*130, i*30 + 60));
					}
				}
				for (i = 0; i < 13; i++){
				paddle.push(new cell(canvas.width / 2 - 150 + i*grid , canvas.height - grid * 3,(ballSpeed*Math.sin(30+(120/cellsAmount)*i)),(ballSpeed*Math.cos(30+(120/cellsAmount)*i))));
				}

			} 
				start();

			function loop() {


				requestAnimationFrame(loop);
				ctx.clearRect(0,0,canvas.width,canvas.height);

				//down.x += down.dx;
				for (i = 0; i < cellsAmount; i++){
					paddle[i].x += paddle[i].speed;
				}

				for (i = 0; i < cellsAmount; i++){
					if (paddle[i].x < grid){
						for (j = 0; j < cellsAmount; j++){
						paddle[j].x = grid*j +15;
						}
					}
				}
				for (i = 0; i < cellsAmount; i++){
					if (paddle[i].x > canvas.width - paddle[i].width){
						for (j = 0; j < cellsAmount; j++){
							paddle[j].x = maxdownx - ((cellsAmount-j) * grid) + grid * cellsAmount + grid;
						}
					}
				}

			//	if (down.x < grid) {

				//	down.x = grid;

				//} else if (down.x > canvas.width - down.width){

				//	down.x = maxdownx;

				//}

				ctx.fillStyle = "white";
				//ctx.fillRect(down.x,down.y,down.width,down.height);
				ctx.fillRect(ball.x,ball.y,ball.width,ball.height);
				ctx.fillText(seconds + " сек", 10, 25);
				for (i=0;i < ups.length;i++){

					ups[i].draw();
				}
				for (i = 0; i < cellsAmount; i++){
					ctx.fillRect(paddle[i].x,paddle[i].y,paddle[i].width,paddle[i].height);
				}


				ball.x += ball.dx;
				ball.y += ball.dy;

				if (ball.y < grid) {

					ball.y = grid;
					ball.dy *= -1;

				} else if (ball.x < grid) {

					ball.x = grid;
					ball.dx *= -1;

				} else if (ball.x + grid > canvas.width - grid) {

					ball.x = canvas.width - grid * 2;
					ball.dx *= -1;
				}

				if (ball.y > canvas.height + 15) {

					
					dead.play();
					alert("u vas mat' sgorela" + paddle[3].y);
					start();
				}
				if (ups.length === tped){
					alert("u vas mat' potushili");
					start();
				}

				/*if (collides(ball, down)) {

					ball.dy *= -1;
					ball.y = down.y + down.height -40;
				}*/
				for (i = 0; i < cellsAmount; i++){
					if (collides(ball, paddle[i])){
						ball.dy = paddle[i].dy;
						ball.y -=10;
						ball.dx = paddle[i].dx;
					}
				}


				for (i=0;i < ups.length;i++){

					if (collides(ball, ups[i])) {

						ball.dy *= -1;
						ball.y = ups[i].y + ups[i].height;
						ups[i].x +=10000;
						tped++;
					}
				}	
			}

			var count = setInterval(counter, 1000);
			var seconds = 0;

			function counter() {

				seconds++;
				ctx.font = "35px Arial";
				ctx.fillStyle = "white";
			}

			document.addEventListener('keydown', buttonpress);

				function buttonpress(e) {
					if (e.which === 37) {

						//down.dx = -paddleSpeed;
					for (i = 0; i < cellsAmount; i++){
						paddle[i].speed = -paddleSpeed;
					}

					} else if (e.which === 39) {

						//down.dx = paddleSpeed;
						for (i = 0; i < cellsAmount; i++){
							paddle[i].speed = paddleSpeed;
						}

					}
				}

				document.addEventListener('keyup', buttonunpress);

				function buttonunpress(e) {

					if (e.which === 37 || e.which === 39) {

						for (i = 0; i < cellsAmount; i++){
							paddle[i].speed = 0;
						}
					}

				}

			requestAnimationFrame(loop);

		</script>

	</body>

</html>